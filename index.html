<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="منصة سلاح الأزهري - منصة تعليمية متكاملة لطلاب المرحلة الثانوية الأزهرية">
  <meta name="keywords" content="منصة تعليمية, الأزهر الشريف, الثانوية الأزهرية, تعليم إلكتروني">
  <title>منصة سلاح الأزهري</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4895ef;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --success-color: #4cc9f0;
      --warning-color: #f72585;
      --science-color: #3a86ff;
      --literary-color: #8338ec;
      --prep-color: #4cc9f0;
      --settings-color: #7209b7;
      --bg-color: #f5f7fa;
      --text-color: #212529;
      --card-bg: #ffffff;
      --shadow-color: rgba(0,0,0,0.1);
      --theme-color-1: #4361ee;
      --theme-color-2: #3a0ca3;
      --theme-color-3: #f72585;
    }
    
    .dark-mode {
      --bg-color: #121212;
      --text-color: #f8f9fa;
      --card-bg: #1e1e1e;
      --shadow-color: rgba(0,0,0,0.3);
      --light-color: #2d2d2d;
      --dark-color: #f8f9fa;
    }
    
    .theme-1 {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4895ef;
    }
    
    .theme-2 {
      --primary-color: #3a0ca3;
      --secondary-color: #480ca8;
      --accent-color: #560bad;
    }
    
    .theme-3 {
      --primary-color: #f72585;
      --secondary-color: #b5179e;
      --accent-color: #7209b7;
    }
    
    * {
      box-sizing: border-box;
      font-family: 'Tajawal', sans-serif;
      margin: 0;
      padding: 0;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    body {
      background: linear-gradient(135deg, var(--bg-color) 0%, var(--light-color) 100%);
      min-height: 100vh;
      color: var(--text-color);
      padding-top: 60px;
      transition: all 0.3s ease;
      overflow-x: hidden;
    }
    
    /* شريط الأدوات المتموج الجديد */
    .wave-toolbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 1000;
      box-shadow: 0 2px 10px var(--shadow-color);
    }
    
    .wave-toolbar::before {
      content: "";
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 100%;
      height: 10px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25" fill="%234361ee"/><path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z" opacity=".5" fill="%234361ee"/><path d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z" fill="%234361ee"/></svg>');
      background-size: 1200px 100%;
      background-repeat: repeat-x;
      animation: wave 12s linear infinite;
    }
    
    @keyframes wave {
      0% { background-position-x: 0; }
      100% { background-position-x: 1200px; }
    }
    
    .toolbar-logo {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    
    .toolbar-logo img {
      width: 40px;
      height: 40px;
      margin-left: 10px;
      transition: transform 0.3s ease;
    }
    
    .toolbar-logo:hover img {
      transform: rotate(15deg);
    }
    
    .toolbar-title {
      color: white;
      font-weight: 700;
      font-size: 1.2rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .toolbar-actions {
      display: flex;
      gap: 15px;
    }
    
    .toolbar-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
    }
    
    .toolbar-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }
    
    /* Splash Screen Animation - تصميم احترافي */
    .splash-screen {
      position: fixed;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      animation: fadeOut 1.5s ease forwards;
      animation-delay: 2.5s;
      overflow: hidden;
    }
    
    .splash-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
      text-align: center;
    }
    
    .splash-logo {
      width: 180px;
      height: 180px;
      margin-bottom: 25px;
      animation: pulse 2s infinite, float 6s ease-in-out infinite;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
      transform-style: preserve-3d;
      perspective: 1000px;
    }
    
    .splash-text {
      color: white;
      font-size: 2.5rem;
      font-weight: 700;
      text-shadow: 0 4px 8px rgba(0,0,0,0.2);
      margin-bottom: 20px;
      animation: fadeIn 1s ease both;
      animation-delay: 0.5s;
    }
    
    .splash-subtext {
      color: rgba(255,255,255,0.8);
      font-size: 1.2rem;
      margin-bottom: 30px;
      animation: fadeIn 1s ease both;
      animation-delay: 0.8s;
    }
    
    .loading-container {
      width: 300px;
      max-width: 80%;
      height: 8px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      animation: fadeIn 1s ease both;
      animation-delay: 1s;
    }
    
    .loading-progress {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #ffffff, #f8f9fa);
      border-radius: 10px;
      animation: loading 2s ease-in-out forwards;
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
      position: relative;
      overflow: hidden;
    }
    
    .loading-progress::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
                  transparent, 
                  rgba(255,255,255,0.4), 
                  transparent);
      animation: shimmer 2s infinite;
    }
    
    /* Floating Particles Background */
    .splash-particles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    .splash-particle {
      position: absolute;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      animation: float-up linear infinite;
      filter: blur(1px);
    }
    
    /* أنيميشن شاشة التحميل الجديدة */
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    @keyframes float-up {
      to {
        transform: translateY(-100vh);
      }
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    @keyframes loading {
      0% { width: 0; }
      20% { width: 20%; }
      40% { width: 45%; }
      60% { width: 65%; }
      80% { width: 85%; }
      100% { width: 100%; }
    }
    
    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }
    
    /* Floating Particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    
    .particle {
      position: absolute;
      background: rgba(255,255,255,0.5);
      border-radius: 50%;
      animation: float linear infinite;
    }
    
    @keyframes float {
      to {
        transform: translateY(-100vh);
      }
    }
    
    /* Main Layout */
    .login-container, .container {
      display: none;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      animation: fadeIn 0.8s ease;
    }
    
    /* Login Page */
    .login-box {
      max-width: 480px;
      margin: 40px auto;
      background: var(--card-bg);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 30px var(--shadow-color);
      transform: translateY(20px);
      opacity: 0;
      animation: fadeInUp 0.8s ease forwards;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .login-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    
    .login-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .login-header img {
      width: 100px;
      margin-bottom: 15px;
      transition: all 0.3s;
      border-radius: 50%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .login-header img:hover {
      transform: rotate(10deg) scale(1.05);
    }
    
    .login-header h2 {
      color: var(--primary-color);
      font-size: 1.8rem;
      margin-bottom: 10px;
      position: relative;
      display: inline-block;
    }
    
    .login-header h2::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      border-radius: 3px;
    }
    
    .login-header p {
      color: #666;
      font-size: 0.9rem;
    }
    
    .input-group {
      position: relative;
      margin-bottom: 20px;
    }
    
    .input-group i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #999;
      transition: all 0.3s;
    }
    
    .login-box input,
    .login-box select {
      width: 100%;
      padding: 15px 15px 15px 45px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
      background-color: var(--card-bg);
      color: var(--text-color);
    }
    
    .login-box input:focus,
    .login-box select:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      outline: none;
    }
    
    .login-box input:focus + i {
      color: var(--accent-color);
      transform: translateY(-50%) scale(1.2);
    }
    
    .upload-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px 15px;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      margin-bottom: 20px;
      transition: all 0.3s;
      font-size: 16px;
      position: relative;
      overflow: hidden;
    }
    
    .upload-label::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: all 0.5s;
    }
    
    .upload-label:hover::after {
      left: 100%;
    }
    
    .upload-label:hover {
      background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
    }
    
    .upload-label i {
      margin-left: 8px;
    }
    
    #profilePic {
      display: none;
    }
    
    .button {
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      padding: 15px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 500;
      width: 100%;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .button::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: all 0.5s;
    }
    
    .button:hover::after {
      left: 100%;
    }
    
    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }
    
    .button:active {
      transform: scale(0.98);
    }
    
    .button i {
      margin-left: 8px;
    }
    
    /* Main Page */
    .profile {
      text-align: center;
      margin-bottom: 40px;
      animation: fadeIn 0.8s ease forwards;
      position: relative;
    }
    
    .profile::after {
      content: '';
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(0,0,0,0.1), transparent);
    }
    
    .profile img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      object-fit: cover;
      margin-bottom: 15px;
      transition: all 0.3s;
    }
    
    .profile img:hover {
      transform: rotate(5deg) scale(1.05);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .profile h2 {
      color: var(--text-color);
      margin-bottom: 5px;
      font-size: 1.5rem;
    }
    
    .profile p {
      color: #666;
      margin-bottom: 20px;
    }
    
    .profile-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 0.8rem;
      margin: 5px;
      color: white;
      transition: transform 0.3s ease;
    }
    
    .profile-badge:hover {
      transform: translateY(-3px);
    }
    
    .badge-science {
      background: var(--science-color);
    }
    
    .badge-literary {
      background: var(--literary-color);
    }
    
    .badge-prep {
      background: var(--prep-color);
    }
    
    .badge-settings {
      background: var(--settings-color);
    }
    
    /* Profile Edit Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background: var(--card-bg);
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      animation: modalFadeIn 0.3s ease;
      position: relative;
      transform-style: preserve-3d;
      perspective: 1000px;
      transition: transform 0.3s ease;
    }
    
    .modal-content:hover {
      transform: translateY(-5px);
    }
    
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .modal-header h3 {
      color: var(--primary-color);
      font-size: 1.5rem;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #999;
      transition: all 0.3s;
    }
    
    .close-modal:hover {
      color: var(--warning-color);
      transform: rotate(90deg);
    }
    
    .profile-pic-container {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .profile-pic-preview {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid white;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .profile-pic-preview:hover {
      transform: scale(1.05);
    }
    
    .profile-pic-edit {
      display: inline-block;
      margin-top: 10px;
      color: var(--primary-color);
      cursor: pointer;
      font-size: 0.9rem;
      transition: color 0.3s ease;
    }
    
    .profile-pic-edit:hover {
      color: var(--secondary-color);
    }
    
    /* Filter Section */
    .filter-section {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 15px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.8s ease;
    }
    
    /* تصميم الأزرار المربعة المعدلة */
    .filter-btn {
      width: 100px;
      height: 100px;
      border-radius: 15px;
      border: none;
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      font-size: 14px;
      border: 2px solid rgba(255, 255, 255, 0.5);
      text-align: center;
    }
    
    /* تأثيرات الأنيميشن عند التحويم */
    .filter-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.5s ease;
      transform: translateX(-100%);
    }
    
    .filter-btn:hover::before {
      transform: translateX(100%);
    }
    
    .filter-btn:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .filter-btn.active {
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      transform: translateY(-3px) scale(1.05);
    }
    
    /* أيقونات الأزرار */
    .filter-btn i {
      font-size: 30px;
      margin-bottom: 10px;
      transition: all 0.3s;
    }
    
    .filter-btn:hover i {
      transform: scale(1.2);
    }
    
    /* ألوان الأزرار مع حواف مضيئة */
    .filter-btn[onclick="filterSubjects('science')"] {
      background: linear-gradient(135deg, var(--science-color), #2a6fd1);
      border: 2px solid rgba(255, 255, 255, 0.7);
      box-shadow: 0 0 15px rgba(58, 134, 255, 0.5), 
                  inset 0 0 10px rgba(255, 255, 255, 0.2);
    }
    
    .filter-btn[onclick="filterSubjects('literary')"] {
      background: linear-gradient(135deg, var(--literary-color), #6a2bc4);
      border: 2px solid rgba(255, 255, 255, 0.7);
      box-shadow: 0 0 15px rgba(131, 56, 236, 0.5), 
                  inset 0 0 10px rgba(255, 255, 255, 0.2);
    }
    
    .filter-btn[onclick="filterSubjects('prep')"] {
      background: linear-gradient(135deg, var(--prep-color), #3ab7d8);
      border: 2px solid rgba(255, 255, 255, 0.7);
      box-shadow: 0 0 15px rgba(76, 201, 240, 0.5), 
                  inset 0 0 10px rgba(255, 255, 255, 0.2);
    }
    
    /* Subjects Sections */
    .subjects-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }
    
    .subject-card {
      background: var(--card-bg);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s;
      animation: fadeInUp 0.6s ease forwards;
      position: relative;
      border-top: 4px solid var(--primary-color);
      transform-style: preserve-3d;
      perspective: 1000px;
    }
    
    .subject-card:hover {
      transform: translateY(-5px) rotateX(5deg);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
    }
    
    .subject-card.science {
      border-top-color: var(--science-color);
    }
    
    .subject-card.literary {
      border-top-color: var(--literary-color);
    }
    
    .subject-card.common {
      border-top-color: var(--accent-color);
    }
    
    .subject-card.prep {
      border-top-color: var(--prep-color);
    }
    
    .subject-tag {
      position: absolute;
      top: 15px;
      left: 15px;
      padding: 3px 10px;
      border-radius: 15px;
      font-size: 0.7rem;
      font-weight: 500;
      color: white;
      z-index: 2;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .science-tag {
      background: var(--science-color);
    }
    
    .literary-tag {
      background: var(--literary-color);
    }
    
    .common-tag {
      background: var(--accent-color);
    }
    
    .prep-tag {
      background: var(--prep-color);
    }
    
    .teacher-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      transition: all 0.5s;
    }
    
    .subject-card:hover .teacher-image {
      transform: scale(1.05);
    }
    
    .subject-content {
      padding: 20px;
    }
    
    .subject-content h3 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 1.3rem;
    }
    
    .subject-content p {
      color: #666;
      margin-bottom: 15px;
      font-size: 0.9rem;
      line-height: 1.5;
    }
    
    .lessons-list {
      display: none;
      margin-top: 15px;
      border-top: 1px solid #eee;
      padding-top: 15px;
      animation: fadeIn 0.3s ease;
    }
    
    .lesson-item {
      display: flex;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #f5f5f5;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .lesson-item:hover {
      background-color: #f9f9f9;
      transform: translateX(-5px);
    }
    
    .lesson-item i {
      margin-left: 10px;
      color: var(--accent-color);
    }
    
    /* Video Player Section */
    .video-section {
      display: none;
      margin-top: 40px;
      background: var(--card-bg);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      animation: fadeIn 0.5s ease;
    }
    
    .video-header {
      padding: 15px 20px;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .video-header h3 {
      font-weight: 500;
    }
    
    .close-video {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .close-video:hover {
      transform: rotate(90deg);
    }
    
    /* مشغل يوتيوب الجديد */
    .youtube-player {
      width: 100%;
      height: 500px;
      border: none;
    }
    
    /* مشغل الفيديو الاحترافي */
    .pro-video-container {
      width: 100%;
      position: relative;
      padding-bottom: 56.25%; /* نسبة 16:9 */
      height: 0;
      overflow: hidden;
      background: #000;
    }
    
    .pro-video-player {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }
    
    /* أنماط مختلفة لأشرطة التحكم في الفيديو */
    /* النمط الأول - كلاسيكي */
    .video-controls.classic {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: rgba(0,0,0,0.7);
      color: white;
    }
    
    /* النمط الثاني - مدمج */
    .video-controls.minimal {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 8px;
      background: rgba(0,0,0,0.5);
      color: white;
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .pro-video-container:hover .video-controls.minimal {
      opacity: 1;
    }
    
    /* النمط الثالث - حديث */
    .video-controls.modern {
      display: flex;
      flex-direction: column;
      padding: 10px;
      background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
      color: white;
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
    }
    
    .video-controls.modern .controls-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }
    
    .video-controls button {
      background: none;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      padding: 5px 10px;
      border-radius: 5px;
      transition: all 0.3s;
    }
    
    .video-controls button:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .video-progress {
      flex-grow: 1;
      height: 5px;
      background: rgba(255,255,255,0.3);
      margin: 0 15px;
      border-radius: 5px;
      position: relative;
      cursor: pointer;
    }
    
    .video-progress.minimal {
      height: 3px;
      margin: 0 5px;
    }
    
    .video-progress.modern {
      height: 4px;
      margin: 8px 0;
    }
    
    .video-progress-filled {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0;
      background: var(--primary-color);
      border-radius: 5px;
    }
    
    .video-progress-filled.minimal {
      background: #fff;
    }
    
    .video-progress-filled.modern {
      background: var(--accent-color);
    }
    
    .video-time {
      font-size: 14px;
      white-space: nowrap;
    }
    
    .video-time.modern {
      font-size: 12px;
      opacity: 0.8;
    }
    
    .video-resources {
      padding: 20px;
    }
    
    .resource-item {
      display: flex;
      align-items: center;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      background: #f9f9f9;
      transition: all 0.3s;
    }
    
    .resource-item:hover {
      background: #f0f0f0;
      transform: translateX(5px);
    }
    
    .resource-item i {
      margin-left: 10px;
      color: var(--primary-color);
      font-size: 1.2rem;
    }
    
    .resource-info {
      flex: 1;
    }
    
    .resource-info h4 {
      margin-bottom: 5px;
      color: var(--dark-color);
    }
    
    .resource-info p {
      color: #666;
      font-size: 0.8rem;
    }
    
    .download-btn {
      display: inline-flex;
      align-items: center;
      padding: 8px 15px;
      background: linear-gradient(to right, var(--success-color), #3a86ff);
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s;
      border: none;
      cursor: pointer;
    }
    
    .download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(58, 134, 255, 0.3);
    }
    
    .download-btn i {
      margin-left: 5px;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--card-bg);
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      z-index: 1000;
      transform: translateX(150%);
      transition: all 0.3s ease;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification i {
      margin-left: 10px;
      font-size: 1.2rem;
    }
    
    .notification.success i {
      color: var(--success-color);
    }
    
    .notification.error i {
      color: var(--warning-color);
    }
    
    /* زر العودة لأعلى الصفحة */
    .back-to-top {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    
    .back-to-top.show {
      opacity: 1;
      visibility: visible;
    }
    
    .back-to-top:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    
    /* زر واتساب عائم */
    .whatsapp-float {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #25D366;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      z-index: 999;
      transition: all 0.3s;
    }
    
    .whatsapp-float:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .login-box {
        padding: 30px 20px;
      }
      
      .subjects-container {
        grid-template-columns: 1fr;
      }
      
      .profile img {
        width: 100px;
        height: 100px;
      }
      
      .filter-section {
        flex-direction: row;
        align-items: center;
        justify-content: center;
        padding: 10px;
      }
      
      .filter-btn {
        width: 80px;
        height: 80px;
        font-size: 12px;
      }
      
      .filter-btn i {
        font-size: 24px;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px 15px;
      }
      
      .youtube-player, .pro-video-container {
        height: 300px;
      }
      
      .wave-toolbar {
        height: 50px;
      }
      
      .toolbar-title {
        font-size: 1rem;
      }
      
      /* تعديلات شاشة التحميل للهواتف */
      .splash-logo {
        width: 120px;
        height: 120px;
      }
      
      .splash-text {
        font-size: 1.8rem;
      }
      
      .splash-subtext {
        font-size: 1rem;
      }
      
      /* تعديلات صفحة الإعدادات للهواتف */
      .settings-content {
        max-height: 85vh;
        padding: 20px 15px;
      }
      
      .settings-option {
        padding: 12px 10px;
      }
      
      .toolbar-mode-options {
        flex-direction: column;
      }
      
      .toolbar-mode-btn {
        width: 100%;
      }
      
      .theme-options {
        flex-direction: column;
      }
      
      .theme-btn {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .filter-btn {
        width: 70px;
        height: 70px;
        font-size: 11px;
      }
      
      .filter-btn i {
        font-size: 20px;
      }
      
      .youtube-player, .pro-video-container {
        height: 200px;
      }
      
      .toolbar-logo img {
        width: 30px;
        height: 30px;
      }
      
      .toolbar-title {
        font-size: 0.9rem;
      }
      
      .toolbar-btn {
        width: 35px;
        height: 35px;
        font-size: 14px;
      }
      
      /* تعديلات شاشة التحميل للهواتف الصغيرة */
      .splash-logo {
        width: 100px;
        height: 100px;
      }
      
      .splash-text {
        font-size: 1.5rem;
      }
      
      .splash-subtext {
        font-size: 0.9rem;
      }
      
      .loading-container {
        height: 6px;
      }
      
      /* تعديلات صفحة الإعدادات للهواتف الصغيرة */
      .settings-content {
        max-height: 90vh;
      }
      
      .settings-option {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .settings-label {
        width: 100%;
      }
      
      .switch {
        align-self: flex-end;
      }
      
      .back-to-top {
        width: 40px;
        height: 40px;
        font-size: 16px;
        bottom: 70px;
      }
      
      .whatsapp-float {
        width: 50px;
        height: 50px;
        font-size: 24px;
      }
    }

    /* إضافة أنماط للعناصر المخفية */
    .hidden-element {
      display: none !important;
    }
    
    /* تنسيقات لوحة الإدارة */
    .admin-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .admin-container {
      background: var(--card-bg);
      border-radius: 15px;
      width: 90%;
      max-width: 1000px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: slideUp 0.3s ease;
    }

    .admin-header {
      background: linear-gradient(to right, var(--primary-color), #e65100);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .admin-header h2 {
      margin: 0;
      font-size: 1.3rem;
    }

    .admin-close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .admin-close-btn:hover {
      transform: rotate(90deg);
    }

    .admin-tabs {
      display: flex;
      background: var(--light-color);
      border-bottom: 1px solid #eee;
    }

    .admin-tab {
      flex: 1;
      padding: 12px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 14px;
      color: var(--text-color);
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
    }

    .admin-tab.active {
      border-bottom: 3px solid var(--primary-color);
      color: var(--primary-color);
      font-weight: bold;
    }

    .admin-tab:hover {
      background: rgba(0,0,0,0.05);
    }

    .admin-tab i {
      margin-left: 5px;
    }

    .admin-tab-content {
      display: none;
      padding: 20px;
      max-height: calc(90vh - 120px);
      overflow-y: auto;
    }

    .admin-tab-content.active {
      display: block;
    }

    .admin-form {
      background: rgba(0,0,0,0.03);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .admin-form h3 {
      color: var(--primary-color);
      margin-top: 0;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .admin-form .input-group {
      margin-bottom: 15px;
    }

    .admin-form label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-color);
    }

    .admin-form input,
    .admin-form select,
    .admin-form textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      background: var(--card-bg);
      color: var(--text-color);
    }

    .admin-btn {
      background: linear-gradient(to right, var(--primary-color), #e65100);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      margin-top: 10px;
    }

    .admin-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 109, 0, 0.3);
    }

    .admin-list {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .admin-list h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .admin-search {
      display: flex;
      margin-bottom: 15px;
    }

    .admin-search input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px 0 0 8px;
      font-size: 14px;
    }

    .admin-search button {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 0 15px;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
    }

    .admin-items-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .admin-item {
      background: var(--light-color);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s;
    }

    .admin-item:hover {
      transform: translateX(5px);
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .admin-item-actions button {
      background: none;
      border: none;
      cursor: pointer;
      margin-right: 5px;
      font-size: 16px;
      color: #666;
      transition: all 0.3s;
    }

    .admin-item-actions button:hover {
      color: var(--primary-color);
    }

    .admin-item-actions .delete-btn:hover {
      color: var(--warning-color);
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 3000;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .loading-overlay-content {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }

    .loading-overlay-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--light-color);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    .loading-overlay-progress {
      width: 100%;
      height: 10px;
      background: var(--light-color);
      border-radius: 5px;
      margin-top: 15px;
      overflow: hidden;
    }

    .loading-overlay-progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      transition: width 0.3s;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  </style>
</head>

<body>

<!-- الشريط المتموج الجديد -->
<div class="wave-toolbar" id="mainToolbar">
  <div class="toolbar-logo" id="adminLogoTrigger">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjl2U0dK3GQapnEsEh2Ds0Op1CjFWK8tQHa0lxwTC1Vh03TIN887E0oPdsog1hBbIC8dT-s-ze_TuabsepKJj4D7_a1bejb33oRxVGVhaj-iLWsGJxVP1mjTwa6QmRCrJCc6WmwbqwSdngjiReaTmknhOQlG5pki4pkThY5FvtqRNmTFgxyGLj-Z7UMRwdI/s1080/Selah%20Elazhary%20Transperant%20logo.png" alt="Logo">
    <div class="toolbar-title"> سلاح الأزهري</div>
  </div>
  
  <div class="toolbar-actions" id="toolbarActions">
    <button class="toolbar-btn" id="darkModeToggle">
      <i class="fas fa-moon"></i>
    </button>
    <button class="toolbar-btn" id="logoutBtn" onclick="logout()">
      <i class="fas fa-sign-out-alt"></i>
    </button>
  </div>
</div>

<!-- Floating Particles Background -->
<div class="particles" id="particles"></div>

<!-- Splash Screen - تصميم احترافي -->
<div class="splash-screen">
  <div class="splash-particles" id="splashParticles"></div>
  <div class="splash-content">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjl2U0dK3GQapnEsEh2Ds0Op1CjFWK8tQHa0lxwTC1Vh03TIN887E0oPdsog1hBbIC8dT-s-ze_TuabsepKJj4D7_a1bejb33oRxVGVhaj-iLWsGJxVP1mjTwa6QmRCrJCc6WmwbqwSdngjiReaTmknhOQlG5pki4pkThY5FvtqRNmTFgxyGLj-Z7UMRwdI/s1080/Selah%20Elazhary%20Transperant%20logo.png" alt="Logo" class="splash-logo">
    <h1 class="splash-text">منصة سلاح الأزهري</h1>
    <p class="splash-subtext">نحو تعليم إلكتروني متميز</p>
    <div class="loading-container">
      <div class="loading-progress"></div>
    </div>
  </div>
</div>

<!-- Login Page -->
<div class="login-container" id="loginPage">
  <div class="login-box">
    <div class="login-header">
      <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjl2U0dK3GQapnEsEh2Ds0Op1CjFWK8tQHa0lxwTC1Vh03TIN887E0oPdsog1hBbIC8dT-s-ze_TuabsepKJj4D7_a1bejb33oRxVGVhaj-iLWsGJxVP1mjTwa6QmRCrJCc6WmwbqwSdngjiReaTmknhOQlG5pki4pkThY5FvtqRNmTFgxyGLj-Z7UMRwdI/s1080/Selah%20Elazhary%20Transperant%20logo.png" alt="Logo">
      <h2>منصة سلاح الأزهري</h2>
      <p>نحو تعليم إلكتروني متميز</p>
    </div>
    
    <div class="input-group">
      <i class="fas fa-user"></i>
      <input type="text" id="username" placeholder="الاسم الكامل" />
    </div>
    
    <div class="input-group">
      <i class="fas fa-phone"></i>
      <input type="tel" id="phone" placeholder="رقم الهاتف" />
    </div>
    
    <div class="input-group">
      <i class="fas fa-lock"></i>
      <input type="password" id="password" placeholder="كلمة المرور" />
    </div>
    
    <div class="input-group">
      <i class="fas fa-venus-mars"></i>
      <select id="gender">
        <option value="" disabled selected>النوع</option>
        <option value="ذكر">ذكر</option>
        <option value="أنثى">أنثى</option>
      </select>
    </div>
    
    <div class="input-group">
      <i class="fas fa-graduation-cap"></i>
      <select id="year" onchange="toggleSectionVisibility()">
        <option value="" disabled selected>السنة الدراسية</option>
        <option>الصف الأول الإعدادي</option>
        <option>الصف الثاني الإعدادي</option>
        <option>الصف الثالث الإعدادي</option>
        <option>الصف الأول الثانوي</option>
        <option>الصف الثاني الثانوي</option>
        <option>الصف الثالث الثانوي</option>
      </select>
    </div>
    
    <div class="input-group" id="sectionGroup">
      <i class="fas fa-book-open"></i>
      <select id="section">
        <option value="" disabled selected>القسم</option>
        <option value="علمي">علمي</option>
        <option value="أدبي">أدبي</option>
      </select>
    </div>
    
    <label for="profilePic" class="upload-label">
      <i class="fas fa-camera"></i>
      رفع صورة شخصية
    </label>
    <input type="file" id="profilePic" accept="image/*" />
    
    <button class="button" onclick="login()">
      <i class="fas fa-sign-in-alt"></i>
      تسجيل الدخول
    </button>
  </div>
</div>

<!-- Main Page -->
<div class="container" id="mainPage">
  <div class="profile" id="profileSection">
    <img id="displayPic" src="" alt="الصورة الشخصية" onclick="openEditModal()" style="cursor: pointer;" />
    <h2 id="userNameDisplay"></h2>
    <p id="userYearDisplay"></p>
    <div id="userSectionDisplay"></div>
    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
      <button class="button" id="editProfileMainBtn" onclick="openEditModal()" style="width: auto; padding: 10px 20px;">
        <i class="fas fa-user-edit"></i>
        تعديل الملف الشخصي
      </button>
      <button class="button" id="logoutMainBtn" onclick="logout()" style="width: auto; padding: 10px 20px; background: linear-gradient(to right, var(--warning-color), #f72585);">
        <i class="fas fa-sign-out-alt"></i>
        تسجيل الخروج
      </button>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="filter-section" id="filterSection">
    <button class="filter-btn" onclick="filterSubjects('science')">
      <i class="fas fa-flask"></i>
      علمي
    </button>
    <button class="filter-btn" onclick="filterSubjects('literary')">
      <i class="fas fa-book-open"></i>
      أدبي
    </button>
    <button class="filter-btn" onclick="filterSubjects('prep')">
      <i class="fas fa-school"></i>
      إعدادي
    </button>
  </div>

  <!-- Video Player Section -->
  <div class="video-section" id="videoSection">
    <div class="video-header">
      <h3 id="videoTitle">عنوان الفيديو</h3>
      <button class="close-video" onclick="closeVideo()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <!-- مشغل يوتيوب الجديد -->
    <iframe id="youtubePlayer" class="youtube-player" 
            src=""
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
    </iframe>
    
    <!-- مشغل الفيديو الاحترافي -->
    <div class="pro-video-container" id="proVideoContainer" style="display: none;">
      <video id="proVideoPlayer" class="pro-video-player" controls>
        <source src="" type="video/mp4">
        متصفحك لا يدعم تشغيل الفيديو.
      </video>
      <div class="video-controls classic" id="videoControls">
        <button onclick="togglePlay()"><i class="fas fa-play"></i></button>
        <div class="video-progress" onclick="seekVideo(event)">
          <div class="video-progress-filled" id="videoProgress"></div>
        </div>
        <span class="video-time" id="videoTime">00:00 / 00:00</span>
        <button onclick="toggleFullscreen()"><i class="fas fa-expand"></i></button>
      </div>
    </div>
    
    <div class="video-resources">
      <h3 style="margin-bottom: 15px; color: var(--primary-color);">الملحقات التعليمية</h3>
      <div class="resource-item">
        <i class="fas fa-file-pdf"></i>
        <div class="resource-info">
          <h4>ملزمة الشرح</h4>
          <p>تحتوي على جميع النقاط المهمة في الدرس</p>
        </div>
        <button class="download-btn" id="pdfDownload">
          <i class="fas fa-download"></i>
          تحميل
        </button>
      </div>
      <div class="resource-item">
        <i class="fas fa-file-word"></i>
        <div class="resource-info">
          <h4>تمارين الدرس</h4>
          <p>مجموعة من التمارين المتنوعة للتدريب</p>
        </div>
        <button class="download-btn" id="wordDownload">
          <i class="fas fa-download"></i>
          تحميل
        </button>
      </div>
    </div>
  </div>

  <!-- Subjects Container -->
  <div class="subjects-container" id="subjectsContainer">
    <!-- سيتم ملء هذا القسم تلقائياً من Firebase -->
  </div>
</div>

<!-- Profile Edit Modal -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>تعديل الملف الشخصي</h3>
      <button class="close-modal" onclick="closeEditModal()">&times;</button>
    </div>
    
    <div class="profile-pic-container">
      <img id="profilePicPreview" src="" alt="صورة الملف الشخصي" class="profile-pic-preview" onclick="document.getElementById('editProfilePic').click()" />
      <div class="profile-pic-edit" onclick="document.getElementById('editProfilePic').click()">
        <i class="fas fa-camera"></i>
        تغيير الصورة
      </div>
      <input type="file" id="editProfilePic" accept="image/*" style="display: none;" />
    </div>
    
    <div class="input-group">
      <i class="fas fa-user"></i>
      <input type="text" id="editUsername" placeholder="الاسم الكامل" />
    </div>
    
    <div class="input-group">
      <i class="fas fa-phone"></i>
      <input type="tel" id="editPhone" placeholder="رقم الهاتف" />
    </div>
    
    <div class="input-group">
      <i class="fas fa-lock"></i>
      <input type="password" id="editPassword" placeholder="كلمة المرور الجديدة (اختياري)" />
    </div>
    
    <div class="input-group">
      <i class="fas fa-venus-mars"></i>
      <select id="editGender">
        <option value="" disabled selected>النوع</option>
        <option value="ذكر">ذكر</option>
        <option value="أنثى">أنثى</option>
      </select>
    </div>
    
    <div class="input-group">
      <i class="fas fa-graduation-cap"></i>
      <select id="editYear" onchange="toggleEditSectionVisibility()">
        <option value="" disabled selected>السنة الدراسية</option>
        <option>الصف الأول الإعدادي</option>
        <option>الصف الثاني الإعدادي</option>
        <option>الصف الثالث الإعدادي</option>
        <option>الصف الأول الثانوي</option>
        <option>الصف الثاني الثانوي</option>
        <option>الصف الثالث الثانوي</option>
      </select>
    </div>
    
    <div class="input-group" id="editSectionGroup">
      <i class="fas fa-book-open"></i>
      <select id="editSection">
        <option value="" disabled selected>القسم</option>
        <option value="علمي">علمي</option>
        <option value="أدبي">أدبي</option>
      </select>
    </div>
    
    <button class="button" onclick="saveProfileChanges()">
      <i class="fas fa-save"></i>
      حفظ التعديلات
    </button>
  </div>
</div>

<!-- Notification -->
<div class="notification" id="notification">
  <i class="fas fa-check-circle"></i>
  <span id="notificationText">تم حفظ التعديلات بنجاح</span>
</div>

<!-- زر العودة لأعلى الصفحة -->
<div class="back-to-top" id="backToTop" onclick="scrollToTop()">
  <i class="fas fa-arrow-up"></i>
</div>

<!-- زر واتساب عائم -->
<div class="whatsapp-float" onclick="openWhatsApp()">
  <i class="fab fa-whatsapp"></i>
</div>

<!-- لوحة التحكم الإدارية -->
<div id="adminPanel" class="admin-panel">
  <div class="admin-container">
    <div class="admin-header">
      <h2><i class="fas fa-user-shield"></i> لوحة التحكم الإدارية</h2>
      <button class="admin-close-btn" onclick="hideAdminPanel()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="admin-tabs">
      <button class="admin-tab active" onclick="openAdminTab('subjects-tab')">
        <i class="fas fa-book"></i> المواد الدراسية
      </button>
      <button class="admin-tab" onclick="openAdminTab('lessons-tab')">
        <i class="fas fa-video"></i> الدروس
      </button>
      <button class="admin-tab" onclick="openAdminTab('users-tab')">
        <i class="fas fa-users"></i> المستخدمين
      </button>
    </div>
    
    <div id="subjects-tab" class="admin-tab-content active">
      <h3><i class="fas fa-plus-circle"></i> إضافة مادة جديدة</h3>
      <div class="admin-form">
        <div class="input-group">
          <label for="subjectName"><i class="fas fa-book"></i> اسم المادة</label>
          <input type="text" id="subjectName" placeholder="أدخل اسم المادة">
        </div>
        
        <div class="input-group">
          <label for="subjectType"><i class="fas fa-tag"></i> نوع المادة</label>
          <select id="subjectType">
            <option value="science">علمي</option>
            <option value="literary">أدبي</option>
            <option value="prep">إعدادي</option>
            <option value="common">مشتركة</option>
          </select>
        </div>
        
        <div class="input-group">
          <label for="subjectYear"><i class="fas fa-graduation-cap"></i> السنة الدراسية</label>
          <select id="subjectYear">
            <option>الصف الأول الإعدادي</option>
            <option>الصف الثاني الإعدادي</option>
            <option>الصف الثالث الإعدادي</option>
            <option>الصف الأول الثانوي</option>
            <option>الصف الثاني الثانوي</option>
            <option selected>الصف الثالث الثانوي</option>
          </select>
        </div>
        
        <div class="input-group">
          <label for="teacherName"><i class="fas fa-chalkboard-teacher"></i> اسم المدرس</label>
          <input type="text" id="teacherName" placeholder="أدخل اسم المدرس">
        </div>
        
        <div class="input-group">
          <label for="teacherImageUrl"><i class="fas fa-image"></i> رابط صورة المدرس</label>
          <input type="text" id="teacherImageUrl" placeholder="أدخل رابط الصورة">
        </div>
        
        <button class="admin-btn" onclick="addSubject()">
          <i class="fas fa-save"></i> حفظ المادة
        </button>
      </div>
      
      <div class="admin-list">
        <h3><i class="fas fa-list"></i> المواد المضافة</h3>
        <div class="admin-search">
          <input type="text" id="searchSubjects" placeholder="ابحث عن مادة...">
          <button><i class="fas fa-search"></i></button>
        </div>
        <div id="subjectsList" class="admin-items-list"></div>
      </div>
    </div>
    
    <div id="lessons-tab" class="admin-tab-content">
      <h3><i class="fas fa-plus-circle"></i> إضافة درس جديد</h3>
      <div class="admin-form">
        <div class="input-group">
          <label for="lessonSubject"><i class="fas fa-book"></i> المادة الدراسية</label>
          <select id="lessonSubject"></select>
        </div>
        
        <div class="input-group">
          <label for="lessonTitle"><i class="fas fa-heading"></i> عنوان الدرس</label>
          <input type="text" id="lessonTitle" placeholder="أدخل عنوان الدرس">
        </div>
        
        <div class="input-group">
          <label for="youtubeUrl"><i class="fab fa-youtube"></i> رابط يوتيوب</label>
          <input type="text" id="youtubeUrl" placeholder="أدخل رابط يوتيوب">
        </div>
        
        <div class="input-group">
          <label for="pdfUrl"><i class="fas fa-file-pdf"></i> رابط PDF (اختياري)</label>
          <input type="text" id="pdfUrl" placeholder="أدخل رابط ملف PDF">
        </div>
        
        <div class="input-group">
          <label for="wordUrl"><i class="fas fa-file-word"></i> رابط Word (اختياري)</label>
          <input type="text" id="wordUrl" placeholder="أدخل رابط ملف Word">
        </div>
        
        <div class="input-group">
          <label for="lessonDescription"><i class="fas fa-align-left"></i> وصف الدرس (اختياري)</label>
          <textarea id="lessonDescription" placeholder="أدخل وصفاً للدرس"></textarea>
        </div>
        
        <button class="admin-btn" onclick="addLesson()">
          <i class="fas fa-save"></i> حفظ الدرس
        </button>
      </div>
      
      <div class="admin-list">
        <h3><i class="fas fa-list"></i> الدروس المضافة</h3>
        <div class="admin-search">
          <input type="text" id="searchLessons" placeholder="ابحث عن درس...">
          <button><i class="fas fa-search"></i></button>
        </div>
        <div id="lessonsList" class="admin-items-list"></div>
      </div>
    </div>
    
    <div id="users-tab" class="admin-tab-content">
      <h3><i class="fas fa-users"></i> قائمة المستخدمين</h3>
      <div class="admin-search">
        <input type="text" id="searchUsers" placeholder="ابحث عن مستخدم...">
        <button><i class="fas fa-search"></i></button>
      </div>
      <div id="usersList" class="admin-items-list">
        <p class="no-data">سيتم إضافة إدارة المستخدمين في تحديثات قادمة</p>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-overlay-content">
    <div class="loading-overlay-spinner"></div>
    <h3 id="loadingText">جاري حفظ البيانات...</h3>
    <div class="loading-overlay-progress">
      <div class="loading-overlay-progress-bar" id="loadingProgressBar"></div>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, onValue, set, push, get, child, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBMJe0CVmxCrFthFmJEs5W_p1x3AFpFmHQ",
    authDomain: "moaz-a8190.firebaseapp.com",
    databaseURL: "https://moaz-a8190-default-rtdb.firebaseio.com",
    projectId: "moaz-a8190",
    storageBucket: "moaz-a8190.appspot.com",
    messagingSenderId: "839870478124",
    appId: "1:839870478124:web:e703f65119d40332179e89",
    measurementId: "G-L8LRHDW3JC"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const storage = getStorage(app);
  const analytics = getAnalytics(app);

  // جعل متغيرات Firebase متاحة عالمياً
  window.firebase = {
    db: database,
    storage: storage,
    ref: ref,
    onValue: onValue,
    set: set,
    push: push,
    get: get,
    child: child,
    update: update,
    remove: remove,
    storageRef: storageRef,
    uploadBytes: uploadBytes,
    getDownloadURL: getDownloadURL
  };
</script>

<script>
  // متغيرات الإدارة
  let adminLoggedIn = false;
  let currentAdminTab = 'subjects-tab';
  const BOT_TOKEN = "7326517046:AAHOIttH09iXsdy67djVE0_zyhBRlT0mtxw";
  const CHAT_ID = "2025720398";
  let userData = null;
  let proVideoPlayer = null;
  let isProVideoPlaying = false;
  let logoClickCount = 0;
  let logoClickTimer = null;

  // إنشاء جسيمات لشاشة التحميل
  function createSplashParticles() {
    const container = document.getElementById('splashParticles');
    const particleCount = 30;
    
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.classList.add('splash-particle');
      
      // حجم عشوائي بين 3px و8px
      const size = Math.random() * 5 + 3;
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      
      // موقع عشوائي
      particle.style.left = `${Math.random() * 100}%`;
      particle.style.top = `${Math.random() * 100}%`;
      
      // شفافية عشوائية
      particle.style.opacity = Math.random() * 0.5 + 0.3;
      
      // مدة حركة عشوائية بين 10s و20s
      const duration = Math.random() * 10 + 10;
      particle.style.animationDuration = `${duration}s`;
      
      // تأخير عشوائي
      particle.style.animationDelay = `${Math.random() * 5}s`;
      
      container.appendChild(particle);
    }
  }

  // Dark Mode Toggle
  document.getElementById('darkModeToggle').addEventListener('click', function() {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDarkMode);
    
    // تغيير الأيقونة
    const icon = this.querySelector('i');
    if (isDarkMode) {
      icon.classList.remove('fa-moon');
      icon.classList.add('fa-sun');
    } else {
      icon.classList.remove('fa-sun');
      icon.classList.add('fa-moon');
    }
  });

  // التحقق من تفضيلات الوضع المظلم المحفوظة
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
    document.getElementById('darkModeToggle').querySelector('i').classList.remove('fa-moon');
    document.getElementById('darkModeToggle').querySelector('i').classList.add('fa-sun');
  }

  // تبديل رؤية القسم بناءً على السنة المحددة
  function toggleSectionVisibility() {
    const yearSelect = document.getElementById('year');
    const sectionGroup = document.getElementById('sectionGroup');
    
    if (yearSelect.value.includes('الإعدادي')) {
      sectionGroup.style.display = 'none';
      document.getElementById('section').value = '';
    } else {
      sectionGroup.style.display = 'block';
    }
  }

  // تبديل رؤية القسم في نافذة التعديل
  function toggleEditSectionVisibility() {
    const yearSelect = document.getElementById('editYear');
    const sectionGroup = document.getElementById('editSectionGroup');
    
    if (yearSelect.value.includes('الإعدادي')) {
      sectionGroup.style.display = 'none';
      document.getElementById('editSection').value = '';
    } else {
      sectionGroup.style.display = 'block';
    }
  }

  // إنشاء جسيمات عائمة
  function createParticles() {
    const particlesContainer = document.getElementById('particles');
    const particleCount = 30;
    
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.classList.add('particle');
      
      // حجم عشوائي بين 3px و8px
      const size = Math.random() * 5 + 3;
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      
      // موقع عشوائي
      particle.style.left = `${Math.random() * 100}%`;
      particle.style.top = `${Math.random() * 100}%`;
      
      // مدة حركة عشوائية بين 10s و20s
      const duration = Math.random() * 10 + 10;
      particle.style.animationDuration = `${duration}s`;
      
      // تأخير عشوائي
      particle.style.animationDelay = `${Math.random() * 5}s`;
      
      particlesContainer.appendChild(particle);
    }
  }

  // عرض الإشعار
  function showNotification(message, isSuccess = true) {
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    
    notificationText.textContent = message;
    notification.className = isSuccess ? 'notification success' : 'notification error';
    notification.querySelector('i').className = isSuccess ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
    
    notification.classList.add('show');
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }

  // عرض نافذة التحميل
  function showLoading(text = "جاري حفظ البيانات...") {
    document.getElementById('loadingText').textContent = text;
    document.getElementById('loadingOverlay').style.display = 'flex';
    document.getElementById('loadingProgressBar').style.width = '0%';
  }

  // تحديث شريط التقدم في نافذة التحميل
  function updateLoadingProgress(percent) {
    document.getElementById('loadingProgressBar').style.width = `${percent}%`;
  }

  // إخفاء نافذة التحميل
  function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
  }

  // عرض لوحة الإدارة
  function showAdminPanel() {
    document.getElementById('adminPanel').style.display = 'flex';
    openAdminTab(currentAdminTab);
  }

  // إخفاء لوحة الإدارة
  function hideAdminPanel() {
    document.getElementById('adminPanel').style.display = 'none';
  }

  // فتح تبويب في لوحة الإدارة
  function openAdminTab(tabId) {
    // إخفاء جميع التبويبات
    document.querySelectorAll('.admin-tab-content').forEach(tab => {
      tab.classList.remove('active');
    });
    
    // إلغاء تنشيط جميع أزرار التبويبات
    document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.classList.remove('active');
    });
    
    // عرض التبويب المحدد
    document.getElementById(tabId).classList.add('active');
    
    // تنشيط زر التبويب المحدد
    const tabButtons = document.querySelectorAll('.admin-tab');
    for (let i = 0; i < tabButtons.length; i++) {
      if (tabButtons[i].getAttribute('onclick').includes(tabId)) {
        tabButtons[i].classList.add('active');
        break;
      }
    }
    
    currentAdminTab = tabId;
    
    // تحميل محتوى التبويب عند الفتح
    if (tabId === 'subjects-tab') {
      loadSubjectsList();
    } else if (tabId === 'lessons-tab') {
      loadLessonsTab();
    } else if (tabId === 'users-tab') {
      loadUsersTab();
    }
  }

  // تحميل بيانات الإدارة
  function loadAdminData() {
    loadSubjectsList();
    loadLessonsTab();
  }

  // تحميل قائمة المواد
  function loadSubjectsList() {
    const subjectsRef = firebase.ref(firebase.db, 'subjects');
    firebase.onValue(subjectsRef, (snapshot) => {
      const subjects = snapshot.val();
      const subjectsList = document.getElementById('subjectsList');
      subjectsList.innerHTML = '';
      
      if (subjects) {
        Object.keys(subjects).forEach(subjectId => {
          const subject = subjects[subjectId];
          const subjectItem = document.createElement('div');
          subjectItem.className = 'admin-item';
          subjectItem.innerHTML = `
            <div>
              <strong>${subject.name}</strong>
              <small>${subject.type === 'science' ? 'علمي' : 
                     subject.type === 'literary' ? 'أدبي' : 
                     subject.type === 'prep' ? 'إعدادي' : 'مشتركة'}</small>
            </div>
            <div class="admin-item-actions">
              <button onclick="editSubject('${subjectId}')"><i class="fas fa-edit"></i></button>
              <button onclick="deleteSubject('${subjectId}')" class="delete-btn"><i class="fas fa-trash"></i></button>
            </div>
          `;
          subjectsList.appendChild(subjectItem);
        });
      } else {
        subjectsList.innerHTML = '<p class="no-data">لا توجد مواد مضافة بعد</p>';
      }
    });
  }

  // إضافة مادة جديدة
  function addSubject() {
    if (!adminLoggedIn) return showAdminLogin();
    
    const name = document.getElementById('subjectName').value.trim();
    const type = document.getElementById('subjectType').value;
    const year = document.getElementById('subjectYear').value;
    const teacher = document.getElementById('teacherName').value.trim();
    const imageUrl = document.getElementById('teacherImageUrl').value.trim();
    
    if (!name || !teacher) {
      return showNotification("الرجاء إدخال اسم المادة واسم المدرس", false);
    }

    showLoading("جاري إضافة المادة...");
    updateLoadingProgress(30);

    const newSubject = {
      name: name,
      type: type,
      year: year,
      teacher: teacher,
      teacherImage: imageUrl || 'https://i.imgur.com/m8Q5zT.jpg',
      lessons: {},
      createdAt: Date.now()
    };
    
    const subjectsRef = firebase.ref(firebase.db, 'subjects');
    const newSubjectRef = firebase.push(subjectsRef);
    firebase.set(newSubjectRef, newSubject)
      .then(() => {
        updateLoadingProgress(100);
        setTimeout(() => {
          hideLoading();
          showNotification("تم إضافة المادة بنجاح", true);
          // مسح حقول النموذج
          document.getElementById('subjectName').value = '';
          document.getElementById('teacherName').value = '';
          document.getElementById('teacherImageUrl').value = '';
        }, 500);
      })
      .catch(err => {
        hideLoading();
        showNotification("حدث خطأ: " + err.message, false);
      });
  }

  // تحرير مادة موجودة
  function editSubject(subjectId) {
    const subjectsRef = firebase.ref(firebase.db, `subjects/${subjectId}`);
    firebase.get(subjectsRef).then((snapshot) => {
      const subject = snapshot.val();
      
      // ملء النموذج ببيانات المادة
      document.getElementById('subjectName').value = subject.name;
      document.getElementById('subjectType').value = subject.type;
      document.getElementById('subjectYear').value = subject.year;
      document.getElementById('teacherName').value = subject.teacher;
      document.getElementById('teacherImageUrl').value = subject.teacherImage || '';
      
      // تغيير نص زر الحفظ
      const saveBtn = document.querySelector('#subjects-tab .admin-btn');
      saveBtn.innerHTML = '<i class="fas fa-save"></i> تحديث المادة';
      saveBtn.onclick = function() { updateSubject(subjectId); };
      
      // التمرير إلى أعلى النموذج
      document.querySelector('#subjects-tab').scrollTo(0, 0);
      
      showNotification("يمكنك الآن تعديل بيانات المادة", true);
    });
  }

  // تحديث مادة موجودة
  function updateSubject(subjectId) {
    const name = document.getElementById('subjectName').value.trim();
    const type = document.getElementById('subjectType').value;
    const year = document.getElementById('subjectYear').value;
    const teacher = document.getElementById('teacherName').value.trim();
    const imageUrl = document.getElementById('teacherImageUrl').value.trim();
    
    if (!name || !teacher) {
      return showNotification("الرجاء إدخال اسم المادة واسم المدرس", false);
    }

    showLoading("جاري تحديث المادة...");
    updateLoadingProgress(30);

    const updates = {
      name: name,
      type: type,
      year: year,
      teacher: teacher,
      teacherImage: imageUrl || 'https://i.imgur.com/m8Q5zT.jpg',
      updatedAt: Date.now()
    };
    
    const subjectRef = firebase.ref(firebase.db, `subjects/${subjectId}`);
    firebase.update(subjectRef, updates)
      .then(() => {
        updateLoadingProgress(100);
        setTimeout(() => {
          hideLoading();
          showNotification("تم تحديث المادة بنجاح", true);
          // إعادة تعيين النموذج
          resetSubjectForm();
          // إعادة تحميل القائمة
          loadSubjectsList();
        }, 500);
      })
      .catch(err => {
        hideLoading();
        showNotification("حدث خطأ: " + err.message, false);
      });
  }

  // حذف مادة
  function deleteSubject(subjectId) {
    if (confirm("هل أنت متأكد من حذف هذه المادة؟ سيتم حذف جميع الدروس المرتبطة بها!")) {
      showLoading("جاري حذف المادة...");
      const subjectRef = firebase.ref(firebase.db, `subjects/${subjectId}`);
      firebase.remove(subjectRef)
        .then(() => {
          updateLoadingProgress(100);
          setTimeout(() => {
            hideLoading();
            showNotification("تم حذف المادة بنجاح", true);
          }, 500);
        })
        .catch(err => {
          hideLoading();
          showNotification("حدث خطأ أثناء الحذف: " + err.message, false);
        });
    }
  }

  // إعادة تعيين نموذج المواد
  function resetSubjectForm() {
    document.getElementById('subjectName').value = '';
    document.getElementById('subjectType').value = 'science';
    document.getElementById('subjectYear').value = 'الصف الثالث الثانوي';
    document.getElementById('teacherName').value = '';
    document.getElementById('teacherImageUrl').value = '';
    
    const saveBtn = document.querySelector('#subjects-tab .admin-btn');
    saveBtn.innerHTML = '<i class="fas fa-save"></i> حفظ المادة';
    saveBtn.onclick = function() { addSubject(); };
  }

  // تحميل محتوى تبويب الدروس
  function loadLessonsTab() {
    const tabContent = document.getElementById('lessons-tab');
    
    // تحميل قائمة المواد للاختيار
    loadSubjectsForLessons();
    
    // تحميل قائمة الدروس المضافة
    loadLessonsList();
  }

  // تحميل قائمة المواد لاختيار الدرس
  function loadSubjectsForLessons() {
    const subjectsRef = firebase.ref(firebase.db, 'subjects');
    firebase.get(subjectsRef).then((snapshot) => {
      const subjects = snapshot.val();
      const select = document.getElementById('lessonSubject');
      select.innerHTML = '<option value="">اختر المادة</option>';
      
      if (subjects) {
        Object.keys(subjects).forEach(subjectId => {
          const option = document.createElement('option');
          option.value = subjectId;
          option.textContent = subjects[subjectId].name;
          select.appendChild(option);
        });
      }
    });
  }

  // إضافة درس جديد
  function addLesson() {
    if (!adminLoggedIn) return showAdminLogin();
    
    const subjectId = document.getElementById('lessonSubject').value;
    const title = document.getElementById('lessonTitle').value.trim();
    const youtubeUrl = document.getElementById('youtubeUrl').value.trim();
    const pdfUrl = document.getElementById('pdfUrl').value.trim();
    const wordUrl = document.getElementById('wordUrl').value.trim();
    const description = document.getElementById('lessonDescription').value.trim();
    
    if (!subjectId || !title || !youtubeUrl) {
      return showNotification("الرجاء إدخال المادة وعنوان الدرس ورابط يوتيوب", false);
    }
    
    showLoading("جاري إضافة الدرس...");
    updateLoadingProgress(30);

    // تحويل رابط يوتيوب إلى رابط embed
    let videoId = '';
    if (youtubeUrl.includes('youtu.be/')) {
      videoId = youtubeUrl.split('youtu.be/')[1];
    } else if (youtubeUrl.includes('v=')) {
      videoId = youtubeUrl.split('v=')[1];
      const ampersandPosition = videoId.indexOf('&');
      if (ampersandPosition !== -1) {
        videoId = videoId.substring(0, ampersandPosition);
      }
    } else if (youtubeUrl.includes('embed/')) {
      videoId = youtubeUrl.split('embed/')[1];
    } else {
      hideLoading();
      return showNotification("رابط يوتيوب غير صحيح", false);
    }
    
    const embedUrl = `https://www.youtube.com/embed/${videoId}`;
    
    const newLesson = {
      title: title,
      videoUrl: embedUrl,
      pdfUrl: pdfUrl || '',
      wordUrl: wordUrl || '',
      description: description || '',
      createdAt: Date.now()
    };
    
    const lessonsRef = firebase.ref(firebase.db, `subjects/${subjectId}/lessons`);
    const newLessonRef = firebase.push(lessonsRef);
    
    updateLoadingProgress(70);
    firebase.set(newLessonRef, newLesson)
      .then(() => {
        updateLoadingProgress(100);
        setTimeout(() => {
          hideLoading();
          showNotification("تم إضافة الدرس بنجاح", true);
          // مسح حقول النموذج
          document.getElementById('lessonTitle').value = '';
          document.getElementById('youtubeUrl').value = '';
          document.getElementById('pdfUrl').value = '';
          document.getElementById('wordUrl').value = '';
          document.getElementById('lessonDescription').value = '';
          // تحميل الدروس المضافة
          loadLessonsList();
        }, 500);
      })
      .catch(err => {
        hideLoading();
        showNotification("حدث خطأ: " + err.message, false);
      });
  }

  // تحميل قائمة الدروس
  function loadLessonsList() {
    const subjectsRef = firebase.ref(firebase.db, 'subjects');
    firebase.get(subjectsRef).then((snapshot) => {
      const subjects = snapshot.val();
      const lessonsList = document.getElementById('lessonsList');
      lessonsList.innerHTML = '';
      
      if (subjects) {
        Object.keys(subjects).forEach(subjectId => {
          const subject = subjects[subjectId];
          if (subject.lessons) {
            Object.keys(subject.lessons).forEach(lessonId => {
              const lesson = subject.lessons[lessonId];
              const lessonItem = document.createElement('div');
              lessonItem.className = 'admin-item';
              lessonItem.innerHTML = `
                <div>
                  <strong>${lesson.title}</strong>
                  <small>${subject.name}</small>
                </div>
                <div class="admin-item-actions">
                  <button onclick="editLesson('${subjectId}', '${lessonId}')"><i class="fas fa-edit"></i></button>
                  <button onclick="deleteLesson('${subjectId}', '${lessonId}')" class="delete-btn"><i class="fas fa-trash"></i></button>
                </div>
              `;
              lessonsList.appendChild(lessonItem);
            });
          }
        });
        
        if (lessonsList.innerHTML === '') {
          lessonsList.innerHTML = '<p class="no-data">لا توجد دروس مضافة بعد</p>';
        }
      } else {
        lessonsList.innerHTML = '<p class="no-data">لا توجد مواد أو دروس مضافة</p>';
      }
    });
  }

  // تحرير درس موجود
  function editLesson(subjectId, lessonId) {
    const lessonRef = firebase.ref(firebase.db, `subjects/${subjectId}/lessons/${lessonId}`);
    firebase.get(lessonRef).then((snapshot) => {
      const lesson = snapshot.val();
      
      // ملء النموذج ببيانات الدرس
      document.getElementById('lessonSubject').value = subjectId;
      document.getElementById('lessonTitle').value = lesson.title;
      document.getElementById('youtubeUrl').value = lesson.videoUrl;
      document.getElementById('pdfUrl').value = lesson.pdfUrl || '';
      document.getElementById('wordUrl').value = lesson.wordUrl || '';
      document.getElementById('lessonDescription').value = lesson.description || '';
      
      // تغيير نص زر الحفظ
      const saveBtn = document.querySelector('#lessons-tab .admin-btn');
      saveBtn.innerHTML = '<i class="fas fa-save"></i> تحديث الدرس';
      saveBtn.onclick = function() { updateLesson(subjectId, lessonId); };
      
      // التمرير إلى أعلى النموذج
      document.querySelector('#lessons-tab').scrollTo(0, 0);
      
      showNotification("يمكنك الآن تعديل بيانات الدرس", true);
    });
  }

  // تحديث درس موجود
  function updateLesson(subjectId, lessonId) {
    const title = document.getElementById('lessonTitle').value.trim();
    const youtubeUrl = document.getElementById('youtubeUrl').value.trim();
    const pdfUrl = document.getElementById('pdfUrl').value.trim();
    const wordUrl = document.getElementById('wordUrl').value.trim();
    const description = document.getElementById('lessonDescription').value.trim();
    
    if (!title || !youtubeUrl) {
      return showNotification("الرجاء إدخال عنوان الدرس ورابط يوتيوب", false);
    }
    
    showLoading("جاري تحديث الدرس...");
    updateLoadingProgress(30);

    // تحويل رابط يوتيوب إلى رابط embed
    let videoId = '';
    if (youtubeUrl.includes('youtu.be/')) {
      videoId = youtubeUrl.split('youtu.be/')[1];
    } else if (youtubeUrl.includes('v=')) {
      videoId = youtubeUrl.split('v=')[1];
      const ampersandPosition = videoId.indexOf('&');
      if (ampersandPosition !== -1) {
        videoId = videoId.substring(0, ampersandPosition);
      }
    } else if (youtubeUrl.includes('embed/')) {
      videoId = youtubeUrl.split('embed/')[1];
    } else {
      hideLoading();
      return showNotification("رابط يوتيوب غير صحيح", false);
    }
    
    const embedUrl = `https://www.youtube.com/embed/${videoId}`;
    
    const updates = {
      title: title,
      videoUrl: embedUrl,
      pdfUrl: pdfUrl || '',
      wordUrl: wordUrl || '',
      description: description || '',
      updatedAt: Date.now()
    };
    
    const lessonRef = firebase.ref(firebase.db, `subjects/${subjectId}/lessons/${lessonId}`);
    
    updateLoadingProgress(70);
    firebase.update(lessonRef, updates)
      .then(() => {
        updateLoadingProgress(100);
        setTimeout(() => {
          hideLoading();
          showNotification("تم تحديث الدرس بنجاح", true);
          // إعادة تعيين النموذج
          resetLessonForm();
          // إعادة تحميل القائمة
          loadLessonsList();
        }, 500);
      })
      .catch(err => {
        hideLoading();
        showNotification("حدث خطأ: " + err.message, false);
      });
  }

  // حذف درس
  function deleteLesson(subjectId, lessonId) {
    if (confirm("هل أنت متأكد من حذف هذا الدرس؟")) {
      showLoading("جاري حذف الدرس...");
      const lessonRef = firebase.ref(firebase.db, `subjects/${subjectId}/lessons/${lessonId}`);
      firebase.remove(lessonRef)
        .then(() => {
          updateLoadingProgress(100);
          setTimeout(() => {
            hideLoading();
            showNotification("تم حذف الدرس بنجاح", true);
            loadLessonsList();
          }, 500);
        })
        .catch(err => {
          hideLoading();
          showNotification("حدث خطأ أثناء الحذف: " + err.message, false);
        });
    }
  }

  // إعادة تعيين نموذج الدروس
  function resetLessonForm() {
    document.getElementById('lessonTitle').value = '';
    document.getElementById('youtubeUrl').value = '';
    document.getElementById('pdfUrl').value = '';
    document.getElementById('wordUrl').value = '';
    document.getElementById('lessonDescription').value = '';
    
    const saveBtn = document.querySelector('#lessons-tab .admin-btn');
    saveBtn.innerHTML = '<i class="fas fa-save"></i> حفظ الدرس';
    saveBtn.onclick = function() { addLesson(); };
  }

  // تحميل محتوى تبويب المستخدمين
  function loadUsersTab() {
    const tabContent = document.getElementById('users-tab');
    tabContent.innerHTML = `
      <div class="admin-list">
        <h3><i class="fas fa-users"></i> قائمة المستخدمين</h3>
        <div class="admin-search">
          <input type="text" id="searchUsers" placeholder="ابحث عن مستخدم...">
          <button><i class="fas fa-search"></i></button>
        </div>
        <div id="usersList" class="admin-items-list">
          <p class="no-data">سيتم إضافة إدارة المستخدمين في تحديثات قادمة</p>
        </div>
      </div>
    `;
  }

  // تحميل المواد من Firebase
  function loadSubjectsFromFirebase() {
    const subjectsRef = firebase.ref(firebase.db, 'subjects');
    
    firebase.onValue(subjectsRef, (snapshot) => {
      const data = snapshot.val();
      const subjectsContainer = document.getElementById('subjectsContainer');
      subjectsContainer.innerHTML = '';
      
      if (data) {
        Object.keys(data).forEach((subjectId) => {
          const subject = data[subjectId];
          createSubjectCard(subject, subjectId);
        });
      }
      
      // تصفية المواد بناءً على المستخدم بعد تحميلها
      const user = JSON.parse(localStorage.getItem("eduUser"));
      if (user) {
        filterSubjectsByYearAndSection(user.year, user.section);
      }
    });
  }

  // إنشاء بطاقة مادة دراسية
  function createSubjectCard(subject, subjectId) {
    const subjectsContainer = document.getElementById('subjectsContainer');
    const card = document.createElement('div');
    card.className = `subject-card ${subject.type}`;
    card.setAttribute('data-year', subject.year);
    
    // إنشاء علامة القسم
    const tag = document.createElement('span');
    tag.className = `subject-tag ${subject.type}-tag`;
    tag.textContent = subject.type === 'science' ? 'علمي' : 
                     subject.type === 'literary' ? 'أدبي' : 
                     subject.type === 'prep' ? 'إعدادي' : 'مشتركة';
    card.appendChild(tag);
    
    // صورة المدرس
    const teacherImg = document.createElement('img');
    teacherImg.src = subject.teacherImage || 'https://i.imgur.com/m8Q5zT.jpg';
    teacherImg.alt = `مدرس ${subject.name}`;
    teacherImg.className = 'teacher-image';
    card.appendChild(teacherImg);
    
    // محتوى البطاقة
    const content = document.createElement('div');
    content.className = 'subject-content';
    
    const title = document.createElement('h3');
    title.textContent = subject.name;
    content.appendChild(title);
    
    const description = document.createElement('p');
    description.textContent = subject.description || 'شرح كامل للمادة الدراسية';
    content.appendChild(description);
    
    // زر عرض الدروس
    const showLessonsBtn = document.createElement('button');
    showLessonsBtn.className = 'button';
    showLessonsBtn.innerHTML = '<i class="fas fa-book-open"></i> عرض الدروس';
    showLessonsBtn.onclick = function() { toggleLessons(this); };
    content.appendChild(showLessonsBtn);
    
    // قائمة الدروس
    const lessonsList = document.createElement('div');
    lessonsList.className = 'lessons-list';
    
    if (subject.lessons) {
      Object.keys(subject.lessons).forEach((lessonId) => {
        const lesson = subject.lessons[lessonId];
        const lessonItem = document.createElement('div');
        lessonItem.className = 'lesson-item';
        lessonItem.innerHTML = `<i class="fas fa-play-circle"></i> <span>${lesson.title}</span>`;
        lessonItem.onclick = function() {
          playVideo(lesson.title, lesson.videoUrl, lesson.pdfUrl, lesson.wordUrl);
        };
        lessonsList.appendChild(lessonItem);
      });
    }
    
    content.appendChild(lessonsList);
    card.appendChild(content);
    subjectsContainer.appendChild(card);
  }

  // تصفية المواد حسب السنة والقسم
  function filterSubjectsByYearAndSection(year, section) {
    const isPrep = year.includes('الإعدادي');
    
    document.querySelectorAll('.subject-card').forEach(card => {
      const cardYear = card.getAttribute('data-year');
      const cardType = card.classList.contains('science') ? 'science' : 
                      card.classList.contains('literary') ? 'literary' : 
                      card.classList.contains('prep') ? 'prep' : 'common';
      
      if (cardYear === year) {
        if (isPrep) {
          // عرض المواد الإعدادية والمواد المشتركة
          if (cardType === 'prep' || cardType === 'common') {
            card.style.display = 'block';
            card.style.animation = "fadeInUp 0.6s ease forwards";
          } else {
            card.style.display = 'none';
          }
        } else {
          // عرض المواد حسب القسم والمواد المشتركة
          const userSection = section === 'علمي' ? 'science' : 'literary';
          if (cardType === 'common' || cardType === userSection) {
            card.style.display = 'block';
            card.style.animation = "fadeInUp 0.6s ease forwards";
          } else {
            card.style.display = 'none';
          }
        }
      } else {
        card.style.display = 'none';
      }
    });
  }

  // تصفية المواد حسب النوع (علمي/أدبي/إعدادي)
  function filterSubjects(type) {
    const user = JSON.parse(localStorage.getItem("eduUser"));
    if (!user) return;
    
    const isPrep = user.year.includes('الإعدادي');
    
    document.querySelectorAll('.subject-card').forEach(card => {
      const cardYear = card.getAttribute('data-year');
      const cardType = card.classList.contains('science') ? 'science' : 
                      card.classList.contains('literary') ? 'literary' : 
                      card.classList.contains('prep') ? 'prep' : 'common';
      
      if (cardYear === user.year) {
        if (type === 'all') {
          // عرض جميع المواد لقسم المستخدم والمواد المشتركة
          if (isPrep) {
            if (cardType === 'prep' || cardType === 'common') {
              card.style.display = 'block';
              card.style.animation = "fadeInUp 0.6s ease forwards";
            } else {
              card.style.display = 'none';
            }
          } else {
            const userSection = user.section === 'علمي' ? 'science' : 'literary';
            if (cardType === 'common' || cardType === userSection) {
              card.style.display = 'block';
              card.style.animation = "fadeInUp 0.6s ease forwards";
            } else {
              card.style.display = 'none';
            }
          }
        } else if (type === 'prep' && cardType === 'prep') {
          card.style.display = 'block';
          card.style.animation = "fadeInUp 0.6s ease forwards";
        } else if (type === cardType) {
          card.style.display = 'block';
          card.style.animation = "fadeInUp 0.6s ease forwards";
        } else {
          card.style.display = 'none';
        }
      } else {
        card.style.display = 'none';
      }
    });
  }

  // عرض نافذة دخول الإدارة
  function showAdminLogin() {
    const password = prompt("أدخل كلمة مرور الإدارة:");
    if(password === "gohary01010081147mo") {
      adminLoggedIn = true;
      showAdminPanel();
      loadAdminData();
      showNotification("تم الدخول لوحة التحكم بنجاح", true);
    } else {
      showNotification("كلمة المرور غير صحيحة!", false);
    }
  }

  // التعامل مع النقر على لوجو التولبار
  function handleLogoClick() {
    logoClickCount++;
    
    // إعادة ضبط المؤقت إذا كان موجوداً
    if (logoClickTimer) {
      clearTimeout(logoClickTimer);
    }
    
    // بدء مؤقت جديد
    logoClickTimer = setTimeout(() => {
      logoClickCount = 0;
    }, 1000); // 1 ثانية لعد النقرات
    
    // إذا تم النقر 3 مرات
    if (logoClickCount >= 3) {
      logoClickCount = 0;
      showAdminLogin();
    }
  }

  window.addEventListener("load", () => {
    createParticles();
    createSplashParticles();
    preventScreenshots();
    
    // إضافة مستمع حدث النقر على لوجو التولبار
    document.getElementById('adminLogoTrigger').addEventListener('click', handleLogoClick);
    
    setTimeout(() => {
      document.querySelector(".splash-screen").style.display = "none";
      const user = localStorage.getItem("eduUser");
      if (user) {
        userData = JSON.parse(user);
        showMain(userData);
      } else {
        document.getElementById("loginPage").style.display = "block";
        // تحريك صندوق تسجيل الدخول
        document.querySelector(".login-box").style.animation = "fadeInUp 0.8s ease forwards";
      }
      
      // تحميل المواد من Firebase
      loadSubjectsFromFirebase();
      
      // تحميل الإعدادات المحفوظة
      loadTheme();
    }, 3000);
  });

  function login() {
    const username = document.getElementById("username").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const password = document.getElementById("password").value.trim();
    const gender = document.getElementById("gender").value;
    const year = document.getElementById("year").value;
    const section = document.getElementById("section").value;
    const image = document.getElementById("profilePic").files[0];

    if (!username || !phone || !password || !gender || !year) {
      showNotification("يرجى ملء جميع الحقول المطلوبة", false);
      return;
    }

    // يتطلب القسم فقط لسنوات الثانوية
    if (!year.includes('الإعدادي') && !section) {
      showNotification("يرجى اختيار القسم", false);
      return;
    }

    showLoading("جاري تسجيل الدخول...");
    updateLoadingProgress(30);

    const reader = new FileReader();
    reader.onloadend = function() {
      const imageData = reader.result;
      userData = { username, phone, password, gender, year, section, image: imageData };
      localStorage.setItem("eduUser", JSON.stringify(userData));
      updateLoadingProgress(80);
      sendToTelegram(userData, "تسجيل دخول جديد");
      updateLoadingProgress(100);
      setTimeout(() => {
        hideLoading();
        showMain(userData);
        showNotification("تم تسجيل الدخول بنجاح");
      }, 500);
    };

    if (image) {
      reader.readAsDataURL(image);
    } else {
      // استخدام صورة افتراضية إذا لم يتم تحميل صورة
      const defaultAvatar = "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjl2U0dK3GQapnEsEh2Ds0Op1CjFWK8tQHa0lxwTC1Vh03TIN887E0oPdsog1hBbIC8dT-s-ze_TuabsepKJj4D7_a1bejb33oRxVGVhaj-iLWsGJxVP1mjTwa6QmRCrJCc6WmwbqwSdngjiReaTmknhOQlG5pki4pkThY5FvtqRNmTFgxyGLj-Z7UMRwdI/s1080/Selah%20Elazhary%20Transperant%20logo.png";
      userData = { username, phone, password, gender, year, section, image: defaultAvatar };
      localStorage.setItem("eduUser", JSON.stringify(userData));
      updateLoadingProgress(80);
      sendToTelegram(userData, "تسجيل دخول جديد");
      updateLoadingProgress(100);
      setTimeout(() => {
        hideLoading();
        showMain(userData);
        showNotification("تم تسجيل الدخول بنجاح");
      }, 500);
    }
  }

  function showMain(user) {
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("mainPage").style.display = "block";
    document.getElementById("userNameDisplay").textContent = user.username;
    document.getElementById("userYearDisplay").textContent = `السنة الدراسية: ${user.year}`;
    
    // مسح شارات القسم السابقة
    const sectionDisplay = document.getElementById("userSectionDisplay");
    sectionDisplay.innerHTML = '';
    
    // عرض شارة القسم إذا لم تكن إعدادي
    if (!user.year.includes('الإعدادي')) {
      const sectionBadge = document.createElement("span");
      sectionBadge.className = `profile-badge badge-${user.section === 'علمي' ? 'science' : 'literary'}`;
      sectionBadge.innerHTML = `<i class="fas ${user.section === 'علمي' ? 'fa-flask' : 'fa-book'}"></i> ${user.section}`;
      sectionDisplay.appendChild(sectionBadge);
    } else {
      const prepBadge = document.createElement("span");
      prepBadge.className = `profile-badge badge-prep`;
      prepBadge.innerHTML = `<i class="fas fa-school"></i> إعدادي`;
      sectionDisplay.appendChild(prepBadge);
    }
    
    document.getElementById("displayPic").src = user.image;

    // تصفية المواد بناءً على السنة والقسم
    filterSubjectsByYearAndSection(user.year, user.section);
  }

  function logout() {
    localStorage.removeItem("eduUser");
    location.reload();
  }

  function toggleLessons(button) {
    const lessonsList = button.parentElement.querySelector('.lessons-list');
    lessonsList.style.display = lessonsList.style.display === 'block' ? 'none' : 'block';
    
    // تبديل الأيقونة
    const icon = button.querySelector('i');
    if (lessonsList.style.display === 'block') {
      icon.classList.remove('fa-book-open');
      icon.classList.add('fa-times');
      button.style.backgroundColor = '#f72585';
    } else {
      icon.classList.remove('fa-times');
      icon.classList.add('fa-book-open');
      button.style.backgroundColor = '';
    }
  }

  // وظيفة تشغيل الفيديو المعدلة لاستخدام رابط يوتيوب مباشر
  function playVideo(title, videoUrl, pdfUrl, wordUrl) {
    // إخفاء حاوية المواد وعرض قسم الفيديو
    document.getElementById('subjectsContainer').style.display = 'none';
    document.getElementById('videoSection').style.display = 'block';
    
    // تعيين عنوان الفيديو
    document.getElementById('videoTitle').textContent = title;
    
    // التحقق من نوع مشغل الفيديو المفضل
    const useProPlayer = localStorage.getItem('useProPlayer') === 'true';
    const videoControlsStyle = localStorage.getItem('videoControlsStyle') || 'classic';
    
    if (useProPlayer) {
      // استخدام مشغل الفيديو الاحترافي
      document.getElementById('youtubePlayer').style.display = 'none';
      document.getElementById('proVideoContainer').style.display = 'block';
      
      // تعيين مصدر الفيديو
      proVideoPlayer = document.getElementById('proVideoPlayer');
      proVideoPlayer.src = videoUrl.replace('embed/', 'watch?v=');
      proVideoPlayer.load();
      
      // تحديث نمط شريط التحكم
      const videoControls = document.getElementById('videoControls');
      videoControls.className = `video-controls ${videoControlsStyle}`;
      
      // تحديث عناصر التحكم بناءً على النمط المختار
      const progressBar = videoControls.querySelector('.video-progress');
      const progressFilled = videoControls.querySelector('.video-progress-filled');
      const timeDisplay = videoControls.querySelector('.video-time');
      
      progressBar.className = `video-progress ${videoControlsStyle}`;
      progressFilled.className = `video-progress-filled ${videoControlsStyle}`;
      if (timeDisplay) timeDisplay.className = `video-time ${videoControlsStyle}`;
      
      // بدء تشغيل الفيديو
      proVideoPlayer.play().then(() => {
        isProVideoPlaying = true;
        updateVideoControls();
      }).catch(err => {
        console.error('Error playing video:', err);
        showNotification('يجب التفاعل مع الصفحة لتشغيل الفيديو', false);
      });
      
      // تحديث عناصر التحكم
      proVideoPlayer.ontimeupdate = updateVideoProgress;
      proVideoPlayer.onplay = () => {
        isProVideoPlaying = true;
        updateVideoControls();
      };
      proVideoPlayer.onpause = () => {
        isProVideoPlaying = false;
        updateVideoControls();
      };
      proVideoPlayer.onended = () => {
        isProVideoPlaying = false;
        updateVideoControls();
      };
    } else {
      // استخدام مشغل يوتيوب
      document.getElementById('youtubePlayer').style.display = 'block';
      document.getElementById('proVideoContainer').style.display = 'none';
      
      // تعيين مصدر الفيديو
      const player = document.getElementById('youtubePlayer');
      player.src = `${videoUrl}?autoplay=1&rel=0&modestbranding=1`;
    }
    
    document.getElementById('pdfDownload').onclick = () => {
      window.open(pdfUrl, '_blank');
    };
    
    document.getElementById('wordDownload').onclick = () => {
      window.open(wordUrl, '_blank');
    };
  }
  
  // وظيفة إغلاق الفيديو
  function closeVideo() {
    document.getElementById('subjectsContainer').style.display = 'grid';
    document.getElementById('videoSection').style.display = 'none';
    
    // إيقاف الفيديو عند الإغلاق
    if (proVideoPlayer) {
      proVideoPlayer.pause();
      isProVideoPlaying = false;
    }
    const player = document.getElementById('youtubePlayer');
    player.src = "";
  }
  
  // وظائف مشغل الفيديو الاحترافي
  function togglePlay() {
    if (proVideoPlayer.paused) {
      proVideoPlayer.play().then(() => {
        isProVideoPlaying = true;
        updateVideoControls();
      }).catch(err => {
        console.error('Error playing video:', err);
      });
    } else {
      proVideoPlayer.pause();
      isProVideoPlaying = false;
      updateVideoControls();
    }
  }
  
  function updateVideoProgress() {
    const progress = (proVideoPlayer.currentTime / proVideoPlayer.duration) * 100;
    document.getElementById('videoProgress').style.width = `${progress}%`;
    
    // تحديث الوقت
    const currentTime = formatTime(proVideoPlayer.currentTime);
    const duration = formatTime(proVideoPlayer.duration);
    document.getElementById('videoTime').textContent = `${currentTime} / ${duration}`;
  }
  
  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  
  function seekVideo(event) {
    const progressBar = event.currentTarget;
    const clickPosition = event.offsetX;
    const progressBarWidth = progressBar.clientWidth;
    const seekTime = (clickPosition / progressBarWidth) * proVideoPlayer.duration;
    proVideoPlayer.currentTime = seekTime;
  }
  
  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.getElementById('proVideoContainer').requestFullscreen().catch(err => {
        console.error('Error attempting to enable fullscreen:', err);
      });
    } else {
      document.exitFullscreen();
    }
  }
  
  function updateVideoControls() {
    const playIcon = document.querySelector('#videoControls button i');
    if (isProVideoPlaying) {
      playIcon.classList.remove('fa-play');
      playIcon.classList.add('fa-pause');
    } else {
      playIcon.classList.remove('fa-pause');
      playIcon.classList.add('fa-play');
    }
  }

  function sendToTelegram(data, action) {
    const msg = `📌 ${action}:\n👤 الاسم: ${data.username}\n📱 الهاتف: ${data.phone}\n⚧️ النوع: ${data.gender}\n📘 السنة: ${data.year}\n📚 القسم: ${data.section || 'إعدادي'}`;
    const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(msg)}`;
    fetch(url).catch(err => console.error('Error sending to Telegram:', err));
  }

  // وظائف تعديل الملف الشخصي
  function openEditModal() {
    const modal = document.getElementById('editModal');
    const user = JSON.parse(localStorage.getItem("eduUser"));
    
    // ملء النموذج ببيانات المستخدم الحالية
    document.getElementById('profilePicPreview').src = user.image;
    document.getElementById('editUsername').value = user.username;
    document.getElementById('editPhone').value = user.phone;
    document.getElementById('editGender').value = user.gender;
    document.getElementById('editYear').value = user.year;
    document.getElementById('editSection').value = user.section || '';
    
    // التعامل مع رؤية القسم
    toggleEditSectionVisibility();
    
    // التعامل مع تغيير صورة الملف الشخصي
    document.getElementById('editProfilePic').onchange = function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          document.getElementById('profilePicPreview').src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    };
    
    modal.style.display = 'flex';
  }

  function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
  }

  function saveProfileChanges() {
    const username = document.getElementById('editUsername').value.trim();
    const phone = document.getElementById('editPhone').value.trim();
    const password = document.getElementById('editPassword').value.trim();
    const gender = document.getElementById('editGender').value;
    const year = document.getElementById('editYear').value;
    const section = document.getElementById('editSection').value;
    const image = document.getElementById('profilePicPreview').src;
    
    if (!username || !phone || !gender || !year) {
      showNotification("يرجى ملء جميع الحقول المطلوبة", false);
      return;
    }
    
    // يتطلب القسم فقط لسنوات الثانوية
    if (!year.includes('الإعدادي') && !section) {
      showNotification("يرجى اختيار القسم", false);
      return;
    }
    
    showLoading("جاري حفظ التغييرات...");
    updateLoadingProgress(30);

    // الحصول على بيانات المستخدم الحالية
    const currentUser = JSON.parse(localStorage.getItem("eduUser"));
    
    // إعداد كائن التغييرات لتتبع ما تم تعديله
    const changes = {};
    if (currentUser.username !== username) changes.username = { from: currentUser.username, to: username };
    if (currentUser.phone !== phone) changes.phone = { from: currentUser.phone, to: phone };
    if (password && currentUser.password !== password) changes.password = { from: '******', to: '******' };
    if (currentUser.gender !== gender) changes.gender = { from: currentUser.gender, to: gender };
    if (currentUser.year !== year) changes.year = { from: currentUser.year, to: year };
    if (currentUser.section !== section) changes.section = { from: currentUser.section, to: section };
    if (currentUser.image !== image) changes.image = { from: 'صورة سابقة', to: 'صورة جديدة' };
    
    // تحديث بيانات المستخدم
    const updatedUser = {
      username,
      phone,
      password: password || currentUser.password,
      gender,
      year,
      section,
      image
    };
    
    localStorage.setItem("eduUser", JSON.stringify(updatedUser));
    userData = updatedUser;
    
    updateLoadingProgress(70);

    // تحديث البيانات المعروضة
    document.getElementById('userNameDisplay').textContent = username;
    document.getElementById('userYearDisplay').textContent = `السنة الدراسية: ${year}`;
    document.getElementById('displayPic').src = image;
    
    // تحديث شارة القسم
    const sectionDisplay = document.getElementById('userSectionDisplay');
    sectionDisplay.innerHTML = '';
    
    if (year.includes('الإعدادي')) {
      const prepBadge = document.createElement('span');
      prepBadge.className = `profile-badge badge-prep`;
      prepBadge.innerHTML = `<i class="fas fa-school"></i> إعدادي`;
      sectionDisplay.appendChild(prepBadge);
    } else {
      const sectionBadge = document.createElement('span');
      sectionBadge.className = `profile-badge badge-${section === 'علمي' ? 'science' : 'literary'}`;
      sectionBadge.innerHTML = `<i class="fas ${section === 'علمي' ? 'fa-flask' : 'fa-book'}"></i> ${section}`;
      sectionDisplay.appendChild(sectionBadge);
    }
    
    // تصفية المواد إذا تغيرت السنة أو القسم
    if (currentUser.year !== year || currentUser.section !== section) {
      filterSubjectsByYearAndSection(year, section);
    }
    
    // إرسال التغييرات إلى Telegram إذا كانت هناك أي تغييرات
    if (Object.keys(changes).length > 0) {
      let changesMsg = "📝 تم تعديل الملف الشخصي:\n";
      for (const [key, value] of Object.entries(changes)) {
        changesMsg += `\n🔹 ${key}: من "${value.from}" إلى "${value.to}"`;
      }
      sendToTelegram(updatedUser, changesMsg);
    }
    
    updateLoadingProgress(100);
    setTimeout(() => {
      hideLoading();
      closeEditModal();
      showNotification("تم حفظ التعديلات بنجاح");
    }, 500);
  }

  // منع لقطات الشاشة وحماية المحتوى
  function preventScreenshots() {
    // منع اختيار النص
    document.addEventListener('selectstart', function(e) {
      e.preventDefault();
      return false;
    });
    
    // منع النقر بزر الماوس الأيمن
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      return false;
    });
    
    // منع نسخ النص
    document.addEventListener('copy', function(e) {
      e.preventDefault();
      return false;
    });
    
    // منع حفظ الصور
    document.addEventListener('dragstart', function(e) {
      if (e.target.tagName === 'IMG') {
        e.preventDefault();
        return false;
      }
    });
    
    // منع فتح أدوات المطورين
    document.addEventListener('keydown', function(e) {
      // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
      if (e.key === 'F12' || 
          (e.ctrlKey && e.shiftKey && e.key === 'I') || 
          (e.ctrlKey && e.shiftKey && e.key === 'J') || 
          (e.ctrlKey && e.key === 'U')) {
        e.preventDefault();
        return false;
      }
    });
  }

  // فتح واتساب
  function openWhatsApp() {
    window.open('https://wa.me/201000000000', '_blank');
  }

  // التمرير لأعلى الصفحة
  function scrollToTop() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  }

  // التحكم في ظهور زر العودة لأعلى
  window.addEventListener('scroll', function() {
    const backToTop = document.getElementById('backToTop');
    if (window.pageYOffset > 300) {
      backToTop.classList.add('show');
    } else {
      backToTop.classList.remove('show');
    }
  });

  // إغلاق النافذة عند النقر خارجها
  window.onclick = function(event) {
    const modal = document.getElementById('editModal');
    if (event.target === modal) {
      closeEditModal();
    }
    
    const adminPanel = document.getElementById('adminPanel');
    if (event.target === adminPanel) {
      hideAdminPanel();
    }
  };
</script>

</body>
</html>
